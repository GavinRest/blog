import{_ as a,c as i,o as n,ae as l}from"./chunks/framework.BHrE6nLq.js";const r=JSON.parse('{"title":"anytype è‡ªæ‰˜ç®¡ (alpine)","description":"","frontmatter":{},"headers":[],"relativePath":"treasure_box/anytype/self-hosted-alpine.md","filePath":"treasure_box/anytype/self-hosted-alpine.md"}'),e={name:"treasure_box/anytype/self-hosted-alpine.md"};function p(t,s,h,k,d,o){return n(),i("div",null,s[0]||(s[0]=[l(`<h1 id="anytype-è‡ªæ‰˜ç®¡-alpine" tabindex="-1">anytype è‡ªæ‰˜ç®¡ (alpine) <a class="header-anchor" href="#anytype-è‡ªæ‰˜ç®¡-alpine" aria-label="Permalink to &quot;anytype è‡ªæ‰˜ç®¡ (alpine)&quot;">â€‹</a></h1><blockquote><p><a href="https://doc.anytype.io/anytype-docs/advanced/data-and-security/self-hosting/self-hosted" target="_blank" rel="noreferrer">https://doc.anytype.io/anytype-docs/advanced/data-and-security/self-hosting/self-hosted</a></p></blockquote><h2 id="å…ˆå†³æ¡ä»¶å®‰è£…å·¥å…·" tabindex="-1">å…ˆå†³æ¡ä»¶å®‰è£…å·¥å…· <a class="header-anchor" href="#å…ˆå†³æ¡ä»¶å®‰è£…å·¥å…·" aria-label="Permalink to &quot;å…ˆå†³æ¡ä»¶å®‰è£…å·¥å…·&quot;">â€‹</a></h2><blockquote><p><a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noreferrer">https://docs.docker.com/engine/install/ubuntu/</a></p></blockquote><ul><li>åœ¨ PVE å®‰è£… alpine CPU ç±»åˆ«å»ºè®®é€‰æ‹© host</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># æ£€æŸ¥æ˜¯å¦æ”¯æŒ avx æŒ‡ä»¤é›†</span></span>
<span class="line"><span>cat /proc/cpuinfo | grep avx</span></span></code></pre></div><h3 id="å®‰è£…-alpine" tabindex="-1">å®‰è£… alpine <a class="header-anchor" href="#å®‰è£…-alpine" aria-label="Permalink to &quot;å®‰è£… alpine&quot;">â€‹</a></h3><ul><li>æ ¹æ®æç¤ºå®‰è£…ç³»ç»Ÿ</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>setup-alpine</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å®‰è£…ç³»ç»Ÿæ—¶å€™é€‰æ‹© sys</span></span></code></pre></div><ul><li>ä¿®æ”¹ IP</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">localhost:~#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/network/interfaces</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loopback</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auto</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">iface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> eth0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> static</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.5.9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        netmask</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255.255.255.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.5.8</span></span></code></pre></div><ul><li>æ·»åŠ  docker æŒ‚è½½ç¡¬ç›˜</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># æ‰‹åŠ¨æ·»åŠ  128G ç¡¬ç›˜</span></span>
<span class="line"><span>Disk /dev/xvdb: 128 GB, 137438953472 bytes, 268435456 sectors</span></span>
<span class="line"><span>16709 cylinders, 255 heads, 63 sectors/track</span></span>
<span class="line"><span>Units: sectors of 1 * 512 = 512 bytes</span></span></code></pre></div><ul><li>æŒ‚è½½ç¡¬ç›˜</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mkdir -p /var/lib/docker</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mkfs.ext4 /dev/xvdb</span></span>
<span class="line"><span># blkid /dev/xvdb</span></span>
<span class="line"><span>/dev/xvdb: UUID=&quot;1cb0d2cd-333f-47f1-8006-60b55ddf5371&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>vi /etc/fstab</span></span>
<span class="line"><span>UUID=1cb0d2cd-333f-47f1-8006-60b55ddf5371 /var/lib/docker ext4 defaults 0 0</span></span></code></pre></div><h3 id="å®‰è£…-docker" tabindex="-1">å®‰è£… docker <a class="header-anchor" href="#å®‰è£…-docker" aria-label="Permalink to &quot;å®‰è£… docker&quot;">â€‹</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://dl-cdn.alpinelinux.org/alpine/latest-stable/community&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/etc/apk/repositories</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose</span></span></code></pre></div><h3 id="éƒ¨ç½²-anytype-è‡ªæ‰˜ç®¡" tabindex="-1">éƒ¨ç½² anytype è‡ªæ‰˜ç®¡ <a class="header-anchor" href="#éƒ¨ç½²-anytype-è‡ªæ‰˜ç®¡" aria-label="Permalink to &quot;éƒ¨ç½² anytype è‡ªæ‰˜ç®¡&quot;">â€‹</a></h3><ul><li>éƒ¨ç½² any-sync-dockercompose</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/anyproto/any-sync-dockercompose.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> any-sync-dockercompose/</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;EXTERNAL_LISTEN_HOSTS=192.168.5.9&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.override</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rc-update</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boot</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span></code></pre></div><ul><li>è·å–é…ç½®æ–‡ä»¶</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>localhost:~/any-sync-dockercompose/etc# cat client.yml</span></span></code></pre></div><h3 id="any-sync-dockercompose-è¿ç§»" tabindex="-1">any-sync-dockercompose è¿ç§» <a class="header-anchor" href="#any-sync-dockercompose-è¿ç§»" aria-label="Permalink to &quot;any-sync-dockercompose è¿ç§»&quot;">â€‹</a></h3><ol><li>è¿ç§» <code>/var/lib/docker</code> ç›®å½•åˆ° <code>alpine</code> æ–°ç³»ç»Ÿ</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span></code></pre></div><ol start="2"><li><p>å°†å¤‡ä»½å¥½çš„ <code>any-sync-dockercompose.tar.gz</code> ä¸Šä¼ åˆ° <code>alpine</code> æ–°ç³»ç»Ÿ</p></li><li></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd /opt/any-sync-dockercompose</span></span>
<span class="line"><span>make start </span></span>
<span class="line"><span>docker-compose up -d</span></span></code></pre></div><h3 id="æ—¥å¿—æ¸…ç†" tabindex="-1">æ—¥å¿—æ¸…ç† <a class="header-anchor" href="#æ—¥å¿—æ¸…ç†" aria-label="Permalink to &quot;æ—¥å¿—æ¸…ç†&quot;">â€‹</a></h3><ul><li>æŸ¥çœ‹æ—¥å¿—</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#  æŸ¥çœ‹æ—¥å¿—</span></span>
<span class="line"><span>docker logs -f any-sync-dockercompose-any-sync-node-1-1 638e20b65528</span></span>
<span class="line"><span>docker logs -f any-sync-dockercompose-any-sync-filenode-1 45bd6622321b</span></span>
<span class="line"><span>docker logs -f any-sync-dockercompose-any-sync-coordinator-1 4d7d2b90346e</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æŸ¥çœ‹å“ªäº›å®¹å™¨æ—¥å¿—å ç©ºé—´æœ€å¤š</span></span>
<span class="line"><span>du -sh /var/lib/docker/containers/*/*-json.log | sort -hr | head</span></span></code></pre></div><ul><li>æ¸…ç†æ—¥å¿—è„šæœ¬</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ğŸ§¹ Starting Docker container logs cleanup...&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è·å–æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CONTAINERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-z</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$CONTAINERS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;âš ï¸  No running containers found. Nothing to do.&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CONTAINER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $CONTAINERS; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LOG_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> inspect</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --format=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;{{.LogPath}}&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$LOG_FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ğŸ§¹ Clearing log for container </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$LOG_FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    truncate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$LOG_FILE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;âŒ Log file not found for container </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  fi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;âœ… All container logs cleaned successfully.&quot;</span></span></code></pre></div>`,32)]))}const F=a(e,[["render",p]]);export{r as __pageData,F as default};
